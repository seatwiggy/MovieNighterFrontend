<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Register</title>
  <script type="text/javascript">
    function createUser(){
        const username = document.getElementById("username").value;
        const contactInfo = document.getElementById("contact_info").value;
        const contactInfoType = document.getElementById("contact_info_type").value;
        let password;
        if(document.getElementById("password")===document.getElementById("password_check")){
            password = document.getElementById("password").value;
            document.getElementById("response").innerHTML = "The passwords you entered do not match";
        }
        const user = {
            "username": username,
            "password": password,
            "contactInfo": contactInfo,
            "contactInfoType": contactInfoType
        };
        let bool = checkIfUserAlreadyExits(username);
        if(bool == true){
            document.getElementById("response").innerHTML = "This username is already in use";
        }
        const xmlHttp = new XMLHttpRequest();
        xmlHttp.open("POST","http://localhost:8082/users/");
        xmlHttp.setRequestHeader("Content-Type","application/json");
        xmlHttp.onreadystatechange = function (){
            console.log("ready state: ", this.status);
            if(this.readyState == XMLHttpRequest.DONE && this.status ==200){
                console.log("succesfully posted user");
                document.getElementById("response").innerHTML = "Welcome"+username;
            }
        }
        xmlHttp.send(JSON.stringify(user));
    }

    //returns true if user exists returns false if user does not exist
    function checkIfUserAlreadyExits(username){
        console.log("find");
        var id = document.getElementById("find_character_id").value;
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.onreadystatechange = function (){
            if(this.readyState == XMLHttpRequest.DONE && this.status ==200){
                var user = JSON.parse(this.responseText);
                if(user!=null){
                    return true;
                }
                else return false;
            }
        }
        xmlHttp.open("GET","http://localhost:8082/user/"+username,true);
        xmlHttp.send();
    }

  </script>
</head>
<body>

<h3>Video</h3>
<br/>
<label>User Name</label>
<input type ="text" id="username"/>
<br/>
<label>Password</label>
<input type ="password" id="password"/>
<br/>
<label>Password Conformation</label>
<input type ="password" id="password_check"/>
<br/>
<label>Contact Info</label>
<textarea row = "8" col="20" id ="contact_info"></textarea>
<br/>
<label>Contact Info type</label>
<p>EX: Email, Discord, Instagram, Phone Number </p>
<textarea row = "8" col="20" id ="contact_info_type"></textarea>
<br/>
<button onclick="createUser();">Make Account</button>
<p id="response"></p>

</body>
</html>